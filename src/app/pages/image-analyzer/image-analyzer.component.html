<div class="w-full px-8 h-screen overflow-hidden" #chatContainer>
  <label class="inline-flex items-center cursor-pointer p-2">
    <input
      type="checkbox"
      value=""
      [(ngModel)]="showDisabled"
      (ngModelChange)="toggleDisplay()"
      class="sr-only peer"
    />
    <div
      class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"
      (click)="toggleDisplay()"
    ></div>
    <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">
      {{ showDisabled ? "Mostrar activado" : "Mostrar deshabilitado" }}</span
    >
  </label>

  <div class="overflow-y-auto h-[30rem]">
    <div
      *ngFor="let imageAnalysis of filteredImageAnalysisList"
      class="p-4 rounded-lg"
      [hidden]="!imageAnalysis.active && !showDisabled"
    >
      <div class="flex justify-between mb-4">
        <div class="w-full flex items-end justify-end">
          <img
            [src]="imageAnalysis.imgbbUrl"
            alt="Gemini Response"
            class="w-80 h-60 object-cover rounded"
          />
        </div>
        <div class="w-1/4 px-4">
          <form
            *ngIf="imageAnalysis.id.toString() === activeEditId"
            (submit)="updateImage(imageAnalysis.id.toString())"
            class="flex flex-col gap-2"
          >
            <input type="file" (change)="onFileChange($event)" class="hidden" />
            <label
              for="fileInput"
              class="cursor-pointer rounded bg-gray-200 text-gray-900 p-2 text-center"
              >Agregar Imagen</label
            >
            <select
              [(ngModel)]="language"
              name="language"
              class="bg-gray-200 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2"
            >
              <option value="" disabled selected>Select Language</option>
              <option value="English">English</option>
              <option value="Español">Spanish</option>
            </select>
            <button
              type="submit"
              [disabled]="!isFormValid()"
              class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
            >
              Enviar
            </button>
            <button
              type="button"
              class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"
              (click)="cancelEdit()"
            >
              Cancelar
            </button>
          </form>
        </div>
      </div>

      <div
        class="inline-flex flex-col items-start justify-start text-white shadow-lg bg-gray-900 rounded-md p-4"
      >
        <p>{{ imageAnalysis.geminiText }}</p>
      </div>
      <div class="flex justify-end mt-4">
        <button
          *ngIf="!showDisabled"
          class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded mr-4"
          (click)="disableImage(imageAnalysis.id.toString())"
        >
          Disable
        </button>
        <button
          *ngIf="showDisabled"
          class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"
          (click)="enableImage(imageAnalysis.id.toString())"
        >
          Enable
        </button>
        <button
          *ngIf="!showDisabled"
          class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-auto"
          (click)="activeEditId = imageAnalysis.id.toString()"
        >
          Update
        </button>
      </div>
    </div>
    <div *ngIf="isLoading" class="flex justify-center items-center p-4">
      <svg
        class="animate-spin h-8 w-8 text-white"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
      >
        <circle
          class="opacity-25"
          cx="12"
          cy="12"
          r="10"
          stroke="currentColor"
          stroke-width="4"
        ></circle>
        <path
          class="opacity-75"
          fill="currentColor"
          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"
        ></path>
      </svg>
    </div>
  </div>
</div>

<form
  *ngIf="!showDisabled"
  (ngSubmit)="onSubmit()"
  class="w-full flex items-center bg-gray-900 p-2 rounded-lg shadow-lg sticky bottom-0 left-0"
>
  <input
    type="file"
    id="fileInput"
    (change)="onFileChange($event)"
    class="hidden"
  />
  <label for="fileInput" class="cursor-pointer p-2 rounded bg-slate-500">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 512 512"
      class="h-6 w-6 text-white hover:text-gray-700"
    >
      <path
        d="M0 96C0 60.7 28.7 32 64 32H448c35.3 0 64 28.7 64 64V416c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V96zM323.8 202.5c-4.5-6.6-11.9-10.5-19.8-10.5s-15.4 3.9-19.8 10.5l-87 127.6L170.7 297c-4.6-5.7-11.5-9-18.7-9s-14.2 3.3-18.7 9l-64 80c-5.8 7.2-6.9 17.1-2.9 25.4s12.4 13.6 21.6 13.6h96 32H424c8.9 0 17.1-4.9 21.2-12.8s3.6-17.4-1.4-24.7l-120-176zM112 192a48 48 0 1 0 0-96 48 48 0 1 0 0 96z"
        fill="currentColor"
      />
    </svg>
  </label>
  <select
    [(ngModel)]="language"
    name="language"
    class="bg-gray-50 border border-gray-300 ml-2 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-40 p-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
  >
    <option value="" disabled selected>Select Language</option>
    <option value="English">English</option>
    <option value="Español">Spanish</option>
  </select>
  <button
    type="submit"
    [disabled]="!isFormValid()"
    [ngClass]="{
      'bg-blue-300': !isFormValid(),
      'bg-blue-500': isFormValid(),
      'text-white': true,
      'p-2': true,
      'rounded-md': true,
      'ml-auto': true
    }"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="h-6 w-6"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
      width="24"
      height="24"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M3 10h18M3 10l7-7m0 14l7-7"
      />
    </svg>
  </button>
</form>
